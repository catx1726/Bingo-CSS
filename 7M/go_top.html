<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GoTop</title>
    <link rel="stylesheet" href="../css/main.css" />
    <style>
      body {
        /* DES 就算超出 main 也不会很突兀 ，因为 Body 有底色 */
        background-color: #126993;
        font-family: Modak, source-han-serif-sc, serif, 'Nunito', 'Lato', consolas;
      }
      .main_container {
        height: 200vh;
        color: white;
        font-size: 1.6rem;
      }
      .content_box {
        font-size: 2rem;
        width: 50vw;
      }
      .trigger_box {
        font-size: 2rem;
        color: white;
        /* right: 20px; */
        bottom: 10vh;
        position: fixed;
        cursor: pointer;
        transition: all 0.3s ease;
        transform: translateX(105vw);
        /* transform: translateX(90vw); */
      }
      .trigger-show {
        transform: translateX(90vw);
      }
    </style>
  </head>
  <body>
    <main class="main_container m-flex flex-jc-center flex-an-center">
      <div class="content_box">
        Lorem ipsum dolor, sit amet consectetur adipisicing elit. Aspernatur corporis, accusantium
        suscipit eligendi voluptas autem quas deserunt iusto veritatis? Saepe impedit sint nulla
        soluta molestias! Exercitationem animi temporibus veritatis totam?
      </div>
    </main>
    <div class="trigger_box">
      <span>GoTop</span>
    </div>
  </body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>
  <script>
    const DOC = document,
      WIN = window

    let btn = DOC.querySelector('.trigger_box'),
      timer = null,
      step = 0

    window.addEventListener('scroll', _.throttle(computeScrollTop, 500))

    function computeScrollTop() {
      let scrollTop = WIN.pageYOffset || DOC.documentElement.scrollTop || DOC.body.scrollTop
      // DES 落下的距离 > header 的高度时 显示
      if (scrollTop < 200) {
        btn.classList.remove('trigger-show')
        return
      }
      btn.classList.add('trigger-show')
    }

    btn.addEventListener('click', goTop, false)

    function goTop() {
      cancelAnimationFrame(timer)
      let distanceTop = WIN.pageYOffset || DOC.documentElement.scrollTop || DOC.body.scrollTop
      step = distanceTop === 100 ? 10 : step
      if (distanceTop > 0) {
        step += 5
        DOC.documentElement.scrollTop = DOC.body.scrollTop = distanceTop - step
        // scrollTop(0, distanceTop - step)
        timer = requestAnimationFrame(goTop)
      } else {
        cancelAnimationFrame(timer)
      }
    }
  </script>
</html>
